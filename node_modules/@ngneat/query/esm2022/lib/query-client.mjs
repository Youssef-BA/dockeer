import { isPlatformBrowser } from '@angular/common';
import { inject, Injectable, InjectionToken, Injector, PLATFORM_ID, } from '@angular/core';
import { QueryClient as _QueryClient, } from '@tanstack/query-core';
import { QUERY_CLIENT_OPTIONS } from './query-client-options';
import { normalizeOptions } from './query-options';
import * as i0 from "@angular/core";
const QueryClientToken = new InjectionToken('QueryClient', {
    providedIn: 'root',
    factory() {
        return new QueryClient(inject(QUERY_CLIENT_OPTIONS));
    },
});
class QueryClientMount {
    constructor() {
        this.instance = inject(QueryClientToken);
        this.instance.mount();
    }
    ngOnDestroy() {
        this.instance.unmount();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.1.3", ngImport: i0, type: QueryClientMount, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.1.3", ngImport: i0, type: QueryClientMount, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.1.3", ngImport: i0, type: QueryClientMount, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: () => [] });
const QueryClientService = new InjectionToken('QueryClientService', {
    providedIn: 'root',
    factory() {
        if (isPlatformBrowser(inject(PLATFORM_ID))) {
            inject(QueryClientMount);
        }
        return inject(QueryClientToken);
    },
});
/** @public */
export function provideQueryClient(queryClient) {
    return {
        provide: QueryClientToken,
        useValue: queryClient,
    };
}
/** @public */
export function injectQueryClient() {
    return inject(QueryClientService);
}
/** should be exported for @test */
export class QueryClient extends _QueryClient {
    #injector = inject(Injector);
    ensureQueryData(options) {
        const defaultedOptions = normalizeOptions(this, options, this.#injector);
        return super.ensureQueryData(defaultedOptions);
    }
    fetchQuery(options) {
        const defaultedOptions = normalizeOptions(this, options, this.#injector);
        return super.fetchQuery(defaultedOptions);
    }
    prefetchQuery(options) {
        const defaultedOptions = normalizeOptions(this, options, this.#injector);
        return super.prefetchQuery(defaultedOptions);
    }
    fetchInfiniteQuery(options) {
        const defaultedOptions = normalizeOptions(this, options, this.#injector);
        return super.fetchInfiniteQuery(defaultedOptions);
    }
    prefetchInfiniteQuery(options) {
        const defaultedOptions = normalizeOptions(this, options, this.#injector);
        return super.prefetchInfiniteQuery(defaultedOptions);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcnktY2xpZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcXVlcnkvc3JjL2xpYi9xdWVyeS1jbGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDcEQsT0FBTyxFQUNMLE1BQU0sRUFDTixVQUFVLEVBQ1YsY0FBYyxFQUNkLFFBQVEsRUFFUixXQUFXLEdBRVosTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNMLFdBQVcsSUFBSSxZQUFZLEdBUTVCLE1BQU0sc0JBQXNCLENBQUM7QUFHOUIsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDOUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saUJBQWlCLENBQUM7O0FBRW5ELE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxjQUFjLENBQWMsYUFBYSxFQUFFO0lBQ3RFLFVBQVUsRUFBRSxNQUFNO0lBQ2xCLE9BQU87UUFDTCxPQUFPLElBQUksV0FBVyxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7SUFDdkQsQ0FBQztDQUNGLENBQUMsQ0FBQztBQUVILE1BR00sZ0JBQWdCO0lBR3BCO1FBRkEsYUFBUSxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBR2xDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzFCLENBQUM7OEdBVEcsZ0JBQWdCO2tIQUFoQixnQkFBZ0IsY0FGUixNQUFNOzsyRkFFZCxnQkFBZ0I7a0JBSHJCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COztBQWFELE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxjQUFjLENBQzNDLG9CQUFvQixFQUNwQjtJQUNFLFVBQVUsRUFBRSxNQUFNO0lBQ2xCLE9BQU87UUFDTCxJQUFJLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDM0MsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDM0IsQ0FBQztRQUVELE9BQU8sTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDbEMsQ0FBQztDQUNGLENBQ0YsQ0FBQztBQUVGLGNBQWM7QUFDZCxNQUFNLFVBQVUsa0JBQWtCLENBQUMsV0FBd0I7SUFDekQsT0FBTztRQUNMLE9BQU8sRUFBRSxnQkFBZ0I7UUFDekIsUUFBUSxFQUFFLFdBQVc7S0FDdEIsQ0FBQztBQUNKLENBQUM7QUFFRCxjQUFjO0FBQ2QsTUFBTSxVQUFVLGlCQUFpQjtJQUMvQixPQUFPLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ3BDLENBQUM7QUFFRCxtQ0FBbUM7QUFDbkMsTUFBTSxPQUFPLFdBQVksU0FBUSxZQUFZO0lBQzNDLFNBQVMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7SUFxQ3BCLGVBQWUsQ0FNdEIsT0FNQztRQUVELE1BQU0sZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQ3ZDLElBQUksRUFDSixPQU1DLEVBQ0QsSUFBSSxDQUFDLFNBQVMsQ0FPZixDQUFDO1FBQ0YsT0FBTyxLQUFLLENBQUMsZUFBZSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDakQsQ0FBQztJQWtEUSxVQUFVLENBT2pCLE9BT0M7UUFFRCxNQUFNLGdCQUFnQixHQUFHLGdCQUFnQixDQUN2QyxJQUFJLEVBQ0osT0FPQyxFQUNELElBQUksQ0FBQyxTQUFTLENBT2YsQ0FBQztRQUNGLE9BQU8sS0FBSyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFzQ1EsYUFBYSxDQU1wQixPQU1DO1FBRUQsTUFBTSxnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FDdkMsSUFBSSxFQUNKLE9BTUMsRUFDRCxJQUFJLENBQUMsU0FBUyxDQU9mLENBQUM7UUFDRixPQUFPLEtBQUssQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBNENRLGtCQUFrQixDQU96QixPQU9DO1FBRUQsTUFBTSxnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FDdkMsSUFBSSxFQUNKLE9BT0MsRUFDRCxJQUFJLENBQUMsU0FBUyxDQU9mLENBQUM7UUFDRixPQUFPLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUE0Q1EscUJBQXFCLENBTzVCLE9BT0M7UUFFRCxNQUFNLGdCQUFnQixHQUFHLGdCQUFnQixDQUN2QyxJQUFJLEVBQ0osT0FPQyxFQUNELElBQUksQ0FBQyxTQUFTLENBT2YsQ0FBQztRQUNGLE9BQU8sS0FBSyxDQUFDLHFCQUFxQixDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDdkQsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHtcbiAgaW5qZWN0LFxuICBJbmplY3RhYmxlLFxuICBJbmplY3Rpb25Ub2tlbixcbiAgSW5qZWN0b3IsXG4gIE9uRGVzdHJveSxcbiAgUExBVEZPUk1fSUQsXG4gIFByb3ZpZGVyLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIFF1ZXJ5Q2xpZW50IGFzIF9RdWVyeUNsaWVudCxcbiAgRGVmYXVsdEVycm9yLFxuICBGZXRjaEluZmluaXRlUXVlcnlPcHRpb25zLFxuICBGZXRjaFF1ZXJ5T3B0aW9ucyxcbiAgSW5maW5pdGVEYXRhLFxuICBJbmZpbml0ZVF1ZXJ5T2JzZXJ2ZXJPcHRpb25zLFxuICBRdWVyeUtleSxcbiAgUXVlcnlPYnNlcnZlck9wdGlvbnMsXG59IGZyb20gJ0B0YW5zdGFjay9xdWVyeS1jb3JlJztcbmltcG9ydCB7IENyZWF0ZUJhc2VRdWVyeU9wdGlvbnMgfSBmcm9tICcuL2Jhc2UtcXVlcnknO1xuaW1wb3J0IHsgQ3JlYXRlSW5maW5pdGVRdWVyeU9wdGlvbnMgfSBmcm9tICcuL2luZmluaXRlLXF1ZXJ5JztcbmltcG9ydCB7IFFVRVJZX0NMSUVOVF9PUFRJT05TIH0gZnJvbSAnLi9xdWVyeS1jbGllbnQtb3B0aW9ucyc7XG5pbXBvcnQgeyBub3JtYWxpemVPcHRpb25zIH0gZnJvbSAnLi9xdWVyeS1vcHRpb25zJztcblxuY29uc3QgUXVlcnlDbGllbnRUb2tlbiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxRdWVyeUNsaWVudD4oJ1F1ZXJ5Q2xpZW50Jywge1xuICBwcm92aWRlZEluOiAncm9vdCcsXG4gIGZhY3RvcnkoKSB7XG4gICAgcmV0dXJuIG5ldyBRdWVyeUNsaWVudChpbmplY3QoUVVFUllfQ0xJRU5UX09QVElPTlMpKTtcbiAgfSxcbn0pO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5jbGFzcyBRdWVyeUNsaWVudE1vdW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgaW5zdGFuY2UgPSBpbmplY3QoUXVlcnlDbGllbnRUb2tlbik7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pbnN0YW5jZS5tb3VudCgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5pbnN0YW5jZS51bm1vdW50KCk7XG4gIH1cbn1cblxuY29uc3QgUXVlcnlDbGllbnRTZXJ2aWNlID0gbmV3IEluamVjdGlvblRva2VuPFF1ZXJ5Q2xpZW50PihcbiAgJ1F1ZXJ5Q2xpZW50U2VydmljZScsXG4gIHtcbiAgICBwcm92aWRlZEluOiAncm9vdCcsXG4gICAgZmFjdG9yeSgpIHtcbiAgICAgIGlmIChpc1BsYXRmb3JtQnJvd3NlcihpbmplY3QoUExBVEZPUk1fSUQpKSkge1xuICAgICAgICBpbmplY3QoUXVlcnlDbGllbnRNb3VudCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpbmplY3QoUXVlcnlDbGllbnRUb2tlbik7XG4gICAgfSxcbiAgfSxcbik7XG5cbi8qKiBAcHVibGljICovXG5leHBvcnQgZnVuY3Rpb24gcHJvdmlkZVF1ZXJ5Q2xpZW50KHF1ZXJ5Q2xpZW50OiBRdWVyeUNsaWVudCk6IFByb3ZpZGVyIHtcbiAgcmV0dXJuIHtcbiAgICBwcm92aWRlOiBRdWVyeUNsaWVudFRva2VuLFxuICAgIHVzZVZhbHVlOiBxdWVyeUNsaWVudCxcbiAgfTtcbn1cblxuLyoqIEBwdWJsaWMgKi9cbmV4cG9ydCBmdW5jdGlvbiBpbmplY3RRdWVyeUNsaWVudCgpIHtcbiAgcmV0dXJuIGluamVjdChRdWVyeUNsaWVudFNlcnZpY2UpO1xufVxuXG4vKiogc2hvdWxkIGJlIGV4cG9ydGVkIGZvciBAdGVzdCAqL1xuZXhwb3J0IGNsYXNzIFF1ZXJ5Q2xpZW50IGV4dGVuZHMgX1F1ZXJ5Q2xpZW50IHtcbiAgI2luamVjdG9yID0gaW5qZWN0KEluamVjdG9yKTtcblxuICAvKipcbiAgICpcbiAgICogQXN5bmNocm9ub3VzIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gZ2V0IGFuIGV4aXN0aW5nIHF1ZXJ5J3MgY2FjaGVkIGRhdGEuXG4gICAqIElmIHRoZSBxdWVyeSBkb2VzIG5vdCBleGlzdCwgcXVlcnlDbGllbnQuZmV0Y2hRdWVyeSB3aWxsIGJlIGNhbGxlZCBhbmQgaXRzIHJlc3VsdHNcbiAgICogcmV0dXJuZWQuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHF1ZXJ5Q2xpZW50ID0gaW5qZWN0UXVlcnlDbGllbnQoKTtcbiAgICpcbiAgICogY29uc3QgZGF0YSA9IGF3YWl0IHF1ZXJ5Q2xpZW50LmVuc3VyZVF1ZXJ5RGF0YSh7IHF1ZXJ5S2V5LCBxdWVyeUZuIH0pXG4gICAqXG4gICAqL1xuICBvdmVycmlkZSBlbnN1cmVRdWVyeURhdGE8XG4gICAgVFF1ZXJ5Rm5EYXRhLFxuICAgIFRFcnJvciA9IERlZmF1bHRFcnJvcixcbiAgICBURGF0YSA9IFRRdWVyeUZuRGF0YSxcbiAgICBUUXVlcnlLZXkgZXh0ZW5kcyBRdWVyeUtleSA9IFF1ZXJ5S2V5LFxuICA+KFxuICAgIG9wdGlvbnM6IENyZWF0ZUJhc2VRdWVyeU9wdGlvbnM8XG4gICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICBURXJyb3IsXG4gICAgICBURGF0YSxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRRdWVyeUtleVxuICAgID4sXG4gICk6IFByb21pc2U8VERhdGE+O1xuICBvdmVycmlkZSBlbnN1cmVRdWVyeURhdGE8XG4gICAgVFF1ZXJ5Rm5EYXRhLFxuICAgIFRFcnJvciA9IERlZmF1bHRFcnJvcixcbiAgICBURGF0YSA9IFRRdWVyeUZuRGF0YSxcbiAgICBUUXVlcnlLZXkgZXh0ZW5kcyBRdWVyeUtleSA9IFF1ZXJ5S2V5LFxuICA+KFxuICAgIG9wdGlvbnM6IEZldGNoUXVlcnlPcHRpb25zPFRRdWVyeUZuRGF0YSwgVEVycm9yLCBURGF0YSwgVFF1ZXJ5S2V5LCBuZXZlcj4sXG4gICk6IFByb21pc2U8VERhdGE+O1xuICBvdmVycmlkZSBlbnN1cmVRdWVyeURhdGE8XG4gICAgVFF1ZXJ5Rm5EYXRhLFxuICAgIFRFcnJvciA9IERlZmF1bHRFcnJvcixcbiAgICBURGF0YSA9IFRRdWVyeUZuRGF0YSxcbiAgICBUUXVlcnlLZXkgZXh0ZW5kcyBRdWVyeUtleSA9IFF1ZXJ5S2V5LFxuICA+KFxuICAgIG9wdGlvbnM6IENyZWF0ZUJhc2VRdWVyeU9wdGlvbnM8XG4gICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICBURXJyb3IsXG4gICAgICBURGF0YSxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRRdWVyeUtleVxuICAgID4sXG4gICk6IFByb21pc2U8VERhdGE+IHtcbiAgICBjb25zdCBkZWZhdWx0ZWRPcHRpb25zID0gbm9ybWFsaXplT3B0aW9ucyhcbiAgICAgIHRoaXMsXG4gICAgICBvcHRpb25zIGFzIFF1ZXJ5T2JzZXJ2ZXJPcHRpb25zPFxuICAgICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICAgIFRFcnJvcixcbiAgICAgICAgVERhdGEsXG4gICAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgICAgVFF1ZXJ5S2V5XG4gICAgICA+LFxuICAgICAgdGhpcy4jaW5qZWN0b3IsXG4gICAgKSBhcyB1bmtub3duIGFzIEZldGNoUXVlcnlPcHRpb25zPFxuICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgVEVycm9yLFxuICAgICAgVERhdGEsXG4gICAgICBUUXVlcnlLZXksXG4gICAgICBuZXZlclxuICAgID47XG4gICAgcmV0dXJuIHN1cGVyLmVuc3VyZVF1ZXJ5RGF0YShkZWZhdWx0ZWRPcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBBc3luY2hyb25vdXMgbWV0aG9kIHRoYXQgY2FuIGJlIHVzZWQgdG8gZmV0Y2ggYW5kIGNhY2hlIGEgcXVlcnkuXG4gICAqIEl0IHdpbGwgZWl0aGVyIHJlc29sdmUgd2l0aCB0aGUgZGF0YSBvciB0aHJvdyB3aXRoIHRoZSBlcnJvci5cbiAgICogVXNlIHRoZSBwcmVmZXRjaFF1ZXJ5IG1ldGhvZCBpZiB5b3UganVzdCB3YW50IHRvIGZldGNoIGEgcXVlcnkgd2l0aG91dFxuICAgKiBuZWVkaW5nIHRoZSByZXN1bHQuXG4gICAqIElmIHRoZSBxdWVyeSBleGlzdHMgYW5kIHRoZSBkYXRhIGlzIG5vdCBpbnZhbGlkYXRlZCBvciBvbGRlciB0aGFuIHRoZSBnaXZlblxuICAgKiBzdGFsZVRpbWUsIHRoZW4gdGhlIGRhdGEgZnJvbSB0aGUgY2FjaGUgd2lsbCBiZSByZXR1cm5lZC5cbiAgICogT3RoZXJ3aXNlIGl0IHdpbGwgdHJ5IHRvIGZldGNoIHRoZSBsYXRlc3QgZGF0YS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogcXVlcnlDbGllbnQgPSBpbmplY3RRdWVyeUNsaWVudCgpO1xuICAgKlxuICAgKiBjb25zdCBkYXRhID0gYXdhaXQgcXVlcnlDbGllbnQuZmV0Y2hRdWVyeSh7IHF1ZXJ5S2V5LCBxdWVyeUZuIH0pXG4gICAqXG4gICAqL1xuICBvdmVycmlkZSBmZXRjaFF1ZXJ5PFxuICAgIFRRdWVyeUZuRGF0YSxcbiAgICBURXJyb3IgPSBEZWZhdWx0RXJyb3IsXG4gICAgVERhdGEgPSBUUXVlcnlGbkRhdGEsXG4gICAgVFF1ZXJ5S2V5IGV4dGVuZHMgUXVlcnlLZXkgPSBRdWVyeUtleSxcbiAgICBUUGFnZVBhcmFtID0gbmV2ZXIsXG4gID4oXG4gICAgb3B0aW9uczogQ3JlYXRlQmFzZVF1ZXJ5T3B0aW9uczxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRFcnJvcixcbiAgICAgIFREYXRhLFxuICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgVFF1ZXJ5S2V5LFxuICAgICAgVFBhZ2VQYXJhbVxuICAgID4sXG4gICk6IFByb21pc2U8VERhdGE+O1xuICBvdmVycmlkZSBmZXRjaFF1ZXJ5PFxuICAgIFRRdWVyeUZuRGF0YSxcbiAgICBURXJyb3IgPSBEZWZhdWx0RXJyb3IsXG4gICAgVERhdGEgPSBUUXVlcnlGbkRhdGEsXG4gICAgVFF1ZXJ5S2V5IGV4dGVuZHMgUXVlcnlLZXkgPSBRdWVyeUtleSxcbiAgICBUUGFnZVBhcmFtID0gbmV2ZXIsXG4gID4oXG4gICAgb3B0aW9uczogRmV0Y2hRdWVyeU9wdGlvbnM8XG4gICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICBURXJyb3IsXG4gICAgICBURGF0YSxcbiAgICAgIFRRdWVyeUtleSxcbiAgICAgIFRQYWdlUGFyYW1cbiAgICA+LFxuICApOiBQcm9taXNlPFREYXRhPjtcbiAgb3ZlcnJpZGUgZmV0Y2hRdWVyeTxcbiAgICBUUXVlcnlGbkRhdGEsXG4gICAgVEVycm9yID0gRGVmYXVsdEVycm9yLFxuICAgIFREYXRhID0gVFF1ZXJ5Rm5EYXRhLFxuICAgIFRRdWVyeUtleSBleHRlbmRzIFF1ZXJ5S2V5ID0gUXVlcnlLZXksXG4gICAgVFBhZ2VQYXJhbSA9IG5ldmVyLFxuICA+KFxuICAgIG9wdGlvbnM6IENyZWF0ZUJhc2VRdWVyeU9wdGlvbnM8XG4gICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICBURXJyb3IsXG4gICAgICBURGF0YSxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRRdWVyeUtleSxcbiAgICAgIFRQYWdlUGFyYW1cbiAgICA+LFxuICApOiBQcm9taXNlPFREYXRhPiB7XG4gICAgY29uc3QgZGVmYXVsdGVkT3B0aW9ucyA9IG5vcm1hbGl6ZU9wdGlvbnMoXG4gICAgICB0aGlzLFxuICAgICAgb3B0aW9ucyBhcyBRdWVyeU9ic2VydmVyT3B0aW9uczxcbiAgICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgICBURXJyb3IsXG4gICAgICAgIFREYXRhLFxuICAgICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICAgIFRRdWVyeUtleSxcbiAgICAgICAgVFBhZ2VQYXJhbVxuICAgICAgPixcbiAgICAgIHRoaXMuI2luamVjdG9yLFxuICAgICkgYXMgdW5rbm93biBhcyBGZXRjaFF1ZXJ5T3B0aW9uczxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRFcnJvcixcbiAgICAgIFREYXRhLFxuICAgICAgVFF1ZXJ5S2V5LFxuICAgICAgVFBhZ2VQYXJhbVxuICAgID47XG4gICAgcmV0dXJuIHN1cGVyLmZldGNoUXVlcnkoZGVmYXVsdGVkT3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQXN5bmNocm9ub3VzIG1ldGhvZCB0aGF0IGNhbiBiZSB1c2VkIHRvIHByZWZldGNoIGEgcXVlcnkgYmVmb3JlXG4gICAqIGl0IGlzIG5lZWRlZCBvciByZW5kZXJlZCB3aXRoIHVzZVF1ZXJ5IGFuZCBmcmllbmRzLlxuICAgKiBUaGUgbWV0aG9kIHdvcmtzIHRoZSBzYW1lIGFzIGZldGNoUXVlcnkgZXhjZXB0IHRoYXQgaXQgd2lsbCBub3RcbiAgICogdGhyb3cgb3IgcmV0dXJuIGFueSBkYXRhLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBxdWVyeUNsaWVudCA9IGluamVjdFF1ZXJ5Q2xpZW50KCk7XG4gICAqXG4gICAqIGF3YWl0IHF1ZXJ5Q2xpZW50LnByZWZldGNoUXVlcnkoeyBxdWVyeUtleSwgcXVlcnlGbiB9KVxuICAgKlxuICAgKi9cbiAgb3ZlcnJpZGUgcHJlZmV0Y2hRdWVyeTxcbiAgICBUUXVlcnlGbkRhdGEsXG4gICAgVEVycm9yID0gRGVmYXVsdEVycm9yLFxuICAgIFREYXRhID0gVFF1ZXJ5Rm5EYXRhLFxuICAgIFRRdWVyeUtleSBleHRlbmRzIFF1ZXJ5S2V5ID0gUXVlcnlLZXksXG4gID4oXG4gICAgb3B0aW9uczogQ3JlYXRlQmFzZVF1ZXJ5T3B0aW9uczxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRFcnJvcixcbiAgICAgIFREYXRhLFxuICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgVFF1ZXJ5S2V5XG4gICAgPixcbiAgKTogUHJvbWlzZTx2b2lkPjtcbiAgb3ZlcnJpZGUgcHJlZmV0Y2hRdWVyeTxcbiAgICBUUXVlcnlGbkRhdGEgPSB1bmtub3duLFxuICAgIFRFcnJvciA9IERlZmF1bHRFcnJvcixcbiAgICBURGF0YSA9IFRRdWVyeUZuRGF0YSxcbiAgICBUUXVlcnlLZXkgZXh0ZW5kcyBRdWVyeUtleSA9IFF1ZXJ5S2V5LFxuICA+KFxuICAgIG9wdGlvbnM6IEZldGNoUXVlcnlPcHRpb25zPFRRdWVyeUZuRGF0YSwgVEVycm9yLCBURGF0YSwgVFF1ZXJ5S2V5PixcbiAgKTogUHJvbWlzZTx2b2lkPjtcbiAgb3ZlcnJpZGUgcHJlZmV0Y2hRdWVyeTxcbiAgICBUUXVlcnlGbkRhdGEsXG4gICAgVEVycm9yID0gRGVmYXVsdEVycm9yLFxuICAgIFREYXRhID0gVFF1ZXJ5Rm5EYXRhLFxuICAgIFRRdWVyeUtleSBleHRlbmRzIFF1ZXJ5S2V5ID0gUXVlcnlLZXksXG4gID4oXG4gICAgb3B0aW9uczogQ3JlYXRlQmFzZVF1ZXJ5T3B0aW9uczxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRFcnJvcixcbiAgICAgIFREYXRhLFxuICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgVFF1ZXJ5S2V5XG4gICAgPixcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZGVmYXVsdGVkT3B0aW9ucyA9IG5vcm1hbGl6ZU9wdGlvbnMoXG4gICAgICB0aGlzLFxuICAgICAgb3B0aW9ucyBhcyBRdWVyeU9ic2VydmVyT3B0aW9uczxcbiAgICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgICBURXJyb3IsXG4gICAgICAgIFREYXRhLFxuICAgICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICAgIFRRdWVyeUtleVxuICAgICAgPixcbiAgICAgIHRoaXMuI2luamVjdG9yLFxuICAgICkgYXMgdW5rbm93biBhcyBGZXRjaFF1ZXJ5T3B0aW9uczxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRFcnJvcixcbiAgICAgIFREYXRhLFxuICAgICAgVFF1ZXJ5S2V5LFxuICAgICAgbmV2ZXJcbiAgICA+O1xuICAgIHJldHVybiBzdXBlci5wcmVmZXRjaFF1ZXJ5KGRlZmF1bHRlZE9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIFNpbWlsYXIgdG8gZmV0Y2hRdWVyeSBidXQgY2FuIGJlIHVzZWQgdG8gZmV0Y2ggYW5kIGNhY2hlIGFuIGluZmluaXRlIHF1ZXJ5XG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHF1ZXJ5Q2xpZW50ID0gaW5qZWN0UXVlcnlDbGllbnQoKTtcbiAgICpcbiAgICogY29uc3QgZGF0YSA9IGF3YWl0IHF1ZXJ5Q2xpZW50LmZldGNoSW5maW5pdGVRdWVyeSh7IHF1ZXJ5S2V5LCBxdWVyeUZuLCBpbml0aWFsUGFnZVBhcmFtLCBnZXRQcmV2aW91c1BhZ2VQYXJhbSwgZ2V0TmV4dFBhZ2VQYXJhbSB9KSB9KVxuICAgKlxuICAgKi9cbiAgb3ZlcnJpZGUgZmV0Y2hJbmZpbml0ZVF1ZXJ5PFxuICAgIFRRdWVyeUZuRGF0YSxcbiAgICBURXJyb3IgPSBEZWZhdWx0RXJyb3IsXG4gICAgVERhdGEgPSBUUXVlcnlGbkRhdGEsXG4gICAgVFF1ZXJ5S2V5IGV4dGVuZHMgUXVlcnlLZXkgPSBRdWVyeUtleSxcbiAgICBUUGFnZVBhcmFtID0gdW5rbm93bixcbiAgPihcbiAgICBvcHRpb25zOiBDcmVhdGVJbmZpbml0ZVF1ZXJ5T3B0aW9uczxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRFcnJvcixcbiAgICAgIFREYXRhLFxuICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgVFF1ZXJ5S2V5LFxuICAgICAgVFBhZ2VQYXJhbVxuICAgID4sXG4gICk6IFByb21pc2U8SW5maW5pdGVEYXRhPFREYXRhLCBUUGFnZVBhcmFtPj47XG4gIG92ZXJyaWRlIGZldGNoSW5maW5pdGVRdWVyeTxcbiAgICBUUXVlcnlGbkRhdGEsXG4gICAgVEVycm9yID0gRGVmYXVsdEVycm9yLFxuICAgIFREYXRhID0gVFF1ZXJ5Rm5EYXRhLFxuICAgIFRRdWVyeUtleSBleHRlbmRzIFF1ZXJ5S2V5ID0gUXVlcnlLZXksXG4gICAgVFBhZ2VQYXJhbSA9IHVua25vd24sXG4gID4oXG4gICAgb3B0aW9uczogRmV0Y2hJbmZpbml0ZVF1ZXJ5T3B0aW9uczxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRFcnJvcixcbiAgICAgIFREYXRhLFxuICAgICAgVFF1ZXJ5S2V5LFxuICAgICAgVFBhZ2VQYXJhbVxuICAgID4sXG4gICk6IFByb21pc2U8SW5maW5pdGVEYXRhPFREYXRhLCBUUGFnZVBhcmFtPj47XG4gIG92ZXJyaWRlIGZldGNoSW5maW5pdGVRdWVyeTxcbiAgICBUUXVlcnlGbkRhdGEsXG4gICAgVEVycm9yID0gRGVmYXVsdEVycm9yLFxuICAgIFREYXRhID0gVFF1ZXJ5Rm5EYXRhLFxuICAgIFRRdWVyeUtleSBleHRlbmRzIFF1ZXJ5S2V5ID0gUXVlcnlLZXksXG4gICAgVFBhZ2VQYXJhbSA9IHVua25vd24sXG4gID4oXG4gICAgb3B0aW9uczogQ3JlYXRlSW5maW5pdGVRdWVyeU9wdGlvbnM8XG4gICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICBURXJyb3IsXG4gICAgICBURGF0YSxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRRdWVyeUtleSxcbiAgICAgIFRQYWdlUGFyYW1cbiAgICA+LFxuICApOiBQcm9taXNlPEluZmluaXRlRGF0YTxURGF0YSwgVFBhZ2VQYXJhbT4+IHtcbiAgICBjb25zdCBkZWZhdWx0ZWRPcHRpb25zID0gbm9ybWFsaXplT3B0aW9ucyhcbiAgICAgIHRoaXMsXG4gICAgICBvcHRpb25zIGFzIEluZmluaXRlUXVlcnlPYnNlcnZlck9wdGlvbnM8XG4gICAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgICAgVEVycm9yLFxuICAgICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgICAgVFF1ZXJ5S2V5LFxuICAgICAgICBUUGFnZVBhcmFtXG4gICAgICA+LFxuICAgICAgdGhpcy4jaW5qZWN0b3IsXG4gICAgKSBhcyB1bmtub3duIGFzIEZldGNoSW5maW5pdGVRdWVyeU9wdGlvbnM8XG4gICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICBURXJyb3IsXG4gICAgICBURGF0YSxcbiAgICAgIFRRdWVyeUtleSxcbiAgICAgIFRQYWdlUGFyYW1cbiAgICA+O1xuICAgIHJldHVybiBzdXBlci5mZXRjaEluZmluaXRlUXVlcnkoZGVmYXVsdGVkT3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogU2ltaWxhciB0byBwcmVmZXRjaFF1ZXJ5IGJ1dCBjYW4gYmUgdXNlZCB0byBwcmVmZXRjaCBhbmQgY2FjaGUgYW4gaW5maW5pdGUgcXVlcnkuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHF1ZXJ5Q2xpZW50ID0gaW5qZWN0UXVlcnlDbGllbnQoKTtcbiAgICpcbiAgICogYXdhaXQgcXVlcnlDbGllbnQucHJlZmV0Y2hJbmZpbml0ZVF1ZXJ5KHsgcXVlcnlLZXksIHF1ZXJ5Rm4sIGluaXRpYWxQYWdlUGFyYW0sIGdldFByZXZpb3VzUGFnZVBhcmFtLCBnZXROZXh0UGFnZVBhcmFtIH0pXG4gICAqXG4gICAqL1xuICBvdmVycmlkZSBwcmVmZXRjaEluZmluaXRlUXVlcnk8XG4gICAgVFF1ZXJ5Rm5EYXRhLFxuICAgIFRFcnJvciA9IERlZmF1bHRFcnJvcixcbiAgICBURGF0YSA9IFRRdWVyeUZuRGF0YSxcbiAgICBUUXVlcnlLZXkgZXh0ZW5kcyBRdWVyeUtleSA9IFF1ZXJ5S2V5LFxuICAgIFRQYWdlUGFyYW0gPSB1bmtub3duLFxuICA+KFxuICAgIG9wdGlvbnM6IENyZWF0ZUluZmluaXRlUXVlcnlPcHRpb25zPFxuICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgVEVycm9yLFxuICAgICAgVERhdGEsXG4gICAgICBUUXVlcnlGbkRhdGEsXG4gICAgICBUUXVlcnlLZXksXG4gICAgICBUUGFnZVBhcmFtXG4gICAgPixcbiAgKTogUHJvbWlzZTx2b2lkPjtcbiAgb3ZlcnJpZGUgcHJlZmV0Y2hJbmZpbml0ZVF1ZXJ5PFxuICAgIFRRdWVyeUZuRGF0YSxcbiAgICBURXJyb3IgPSBEZWZhdWx0RXJyb3IsXG4gICAgVERhdGEgPSBUUXVlcnlGbkRhdGEsXG4gICAgVFF1ZXJ5S2V5IGV4dGVuZHMgUXVlcnlLZXkgPSBRdWVyeUtleSxcbiAgICBUUGFnZVBhcmFtID0gdW5rbm93bixcbiAgPihcbiAgICBvcHRpb25zOiBGZXRjaEluZmluaXRlUXVlcnlPcHRpb25zPFxuICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgVEVycm9yLFxuICAgICAgVERhdGEsXG4gICAgICBUUXVlcnlLZXksXG4gICAgICBUUGFnZVBhcmFtXG4gICAgPixcbiAgKTogUHJvbWlzZTx2b2lkPjtcbiAgb3ZlcnJpZGUgcHJlZmV0Y2hJbmZpbml0ZVF1ZXJ5PFxuICAgIFRRdWVyeUZuRGF0YSxcbiAgICBURXJyb3IgPSBEZWZhdWx0RXJyb3IsXG4gICAgVERhdGEgPSBUUXVlcnlGbkRhdGEsXG4gICAgVFF1ZXJ5S2V5IGV4dGVuZHMgUXVlcnlLZXkgPSBRdWVyeUtleSxcbiAgICBUUGFnZVBhcmFtID0gdW5rbm93bixcbiAgPihcbiAgICBvcHRpb25zOiBDcmVhdGVJbmZpbml0ZVF1ZXJ5T3B0aW9uczxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRFcnJvcixcbiAgICAgIFREYXRhLFxuICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgVFF1ZXJ5S2V5LFxuICAgICAgVFBhZ2VQYXJhbVxuICAgID4sXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGRlZmF1bHRlZE9wdGlvbnMgPSBub3JtYWxpemVPcHRpb25zKFxuICAgICAgdGhpcyxcbiAgICAgIG9wdGlvbnMgYXMgSW5maW5pdGVRdWVyeU9ic2VydmVyT3B0aW9uczxcbiAgICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgICBURXJyb3IsXG4gICAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgICAgVFF1ZXJ5Rm5EYXRhLFxuICAgICAgICBUUXVlcnlLZXksXG4gICAgICAgIFRQYWdlUGFyYW1cbiAgICAgID4sXG4gICAgICB0aGlzLiNpbmplY3RvcixcbiAgICApIGFzIHVua25vd24gYXMgRmV0Y2hJbmZpbml0ZVF1ZXJ5T3B0aW9uczxcbiAgICAgIFRRdWVyeUZuRGF0YSxcbiAgICAgIFRFcnJvcixcbiAgICAgIFREYXRhLFxuICAgICAgVFF1ZXJ5S2V5LFxuICAgICAgVFBhZ2VQYXJhbVxuICAgID47XG4gICAgcmV0dXJuIHN1cGVyLnByZWZldGNoSW5maW5pdGVRdWVyeShkZWZhdWx0ZWRPcHRpb25zKTtcbiAgfVxufVxuIl19